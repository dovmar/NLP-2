function minus(target){target.mousedown(function(e){e.preventDefault();});var elem=target.parent().find('[data-value]'),input=isInput(elem),action="minus";setValue(input,elem,action);}function sum(target){target.mousedown(function(e){e.preventDefault();});var elem=target.parent().find('[data-value]'),input=isInput(elem),action="sum";setValue(input,elem,action);}function val(target){if(isInput(target)){var stock=parseInt(target.attr('max'));var value=(target.val()%1!=0)?parseFloat(target.val()).toFixed(2):parseInt(target.val());if(value>stock||value<1||!value){nvalue=(value<1||!value)?1:stock;target.val(nvalue);}else{nvalue=value;target.val(nvalue);}target.parent().find('span.action').removeClass('disabled').removeClass('bl').removeClass('br');if(nvalue<2)target.parent().find('[data-action="minus"]').addClass('disabled').addClass('br');if(nvalue>=stock)target.parent().find('[data-action="sum"]').addClass('disabled').addClass('bl');}else{return false;}}function isInput(target){return target.is('input')?true:false;}function setValue(input,target,action){return(input)?setInput(target,action):setText(target,action);}function setInput(target,action){return(action==='sum')?sumInput(target):minusInput(target);}function sumInput(target){var value=parseInt(target.val()),stock=parseInt(target.attr('max'));var newValue=(value>=1&&value<stock)?value+1:value;if(newValue>=stock){target.parent().find('[data-action="sum"]').addClass('disabled').addClass('bl');}return target.val(newValue);}function minusInput(target){var value=parseInt(target.val()),stock=parseInt(target.attr('max'));var newValue=(value>1)?value-1:1;if(newValue<2){target.parent().find('[data-action="minus"]').addClass('disabled').addClass('br');}return target.val(newValue);}function setText(target,action){return(action==='sum')?sumText(target):minusText(target);}function sumText(target){var value=parseInt(target.text()),stock=parseInt(target.attr('max'));var newValue=(value>=1&&value<stock)?value+1:value;if(newValue>=stock){target.parent().find('[data-action="sum"]').addClass('disabled').addClass('bl');}return target.attr('data-value',newValue).text(newValue);}function minusText(target){var value=parseInt(target.text());var newValue=(value>1)?value-1:1;if(newValue<2){target.parent().find('[data-action="minus"]').addClass('disabled').addClass('br');}return target.attr('data-value',newValue).text(newValue);}$(document).off('click','[data-quantity] [data-action]');$(document).on('click','[data-quantity] [data-action]',function(e){e.preventDefault();var action=$(this).data('action');$(this).parent().find('span.action').removeClass('disabled').removeClass('bl').removeClass('br');switch(action){case"sum":sum($(this));break;case"minus":minus($(this));break;default:return false;}});$(document).on('focusout change','[data-quantity] [data-value]',function(e){e.preventDefault();val($(this));});