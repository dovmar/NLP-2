var Modal={"main":function(){$('[data-action="modalConfirmation-cancel"]').click(Modal.confirmationCancel)
$('[data-action="modalConfirmation-delete"]').click(Modal.confirmationDelete)
$('#modalConfirmation').on('hidden.bs.modal',Modal.confirmationResetModal)
$('[data-action="sendEmailStockNotify"] ').submit(Modal.sendEmailStockNotify)},"confirm":function(params){if(params===undefined){params=null;}if(params){$('#modalConfirmation [role="document"]').busyLoad('show');$("#modalConfirmation[role='dialog']").modal().unbind('shown.bs.modal').on('shown.bs.modal',function(){$('#modalConfirmation [role="document"]').busyLoad('show');Modal.confirmationResetModal()
Modal.confirmationSetContent(params)});}else{return false;}},"confirmationSetContent":function(params){if(params===undefined){params=null;}let body,footer
body=$('#modalConfirmation .modal-content .modal-body')
footer=$('#modalConfirmation .modal-content .modal-footer')
body.find('[data-title]').html(params.info.title)
body.find('[data-content]').html(params.info.description)
$('#modalConfirmation [role="document"]').busyLoad('hide');$('#modalConfirmation').find('[data-action="modalConfirmation-delete"]').attr('data-id',params.data.id);},"confirmationCancel":function(e){e.preventDefault()
Modal.confirmationResetModal()},"confirmationDelete":function(e){e.preventDefault()
let dataID
dataID=($(this)[0].hasAttribute("data-id")&&$(this).attr('data-id').length>0)?$(this).attr('data-id'):null
if(dataID){let modalContent=$(this).parents('.modal-content');modalContent.busyLoad('show');$.ajax({async:false,type:"POST",data:{"id_address":dataID,"csrf":$(".addressAccount[name='csrf']").val()},dataType:"json",url:validateURL.URL()+"/client/deleteaddress",success:function(data){if(data.success==true){modalContent.busyLoad('hide');location.reload(true);}},timeout:10000});}},"confirmationResetModal":function(){$("#modalConfirmation[role='dialog'] [data-title], #modalConfirmation[role='dialog'] [data-content]").html('');},"sendEmailStockNotify":function(e){e.preventDefault()
var form=$(this).parent('[class*="-form"]');var container=$(this).parents('.collapse.show')
var email=$(this).find('[name="email"]').val();var id_item=$(this).data("item");Modal.saveItemEmailNotification(email,id_item,form,container)},saveItemEmailNotification:function(email,id_item,form,container){container.busyLoad('show')
container.find('[data-tag]').hide()
$.ajax({async:false,type:"POST",data:{"email":email,"id_item":id_item},dataType:"json",url:validateURL.URL()+"/products/saveItemEmailNotification",success:function(data){if(data.success==true){form.hide()
container.find('[data-tag="success"]').show()
container.busyLoad('hide');}else{container.find('[data-tag="warning"] [data-type="text"]').text(data.text)
container.find('[data-tag="warning"]').show()
container.find('[data-tag="message"]').show()
form.show()
container.busyLoad('hide');}},timeout:10000});},}
function loadBuyModal(target,alternative,items){$('#modal').modal().off('shown.bs.modal');var id=(target.data("item"))?target.data("item"):target.prop("data-item");var q=(target.data("qItemsAdd"))?target.data("qItemsAdd"):1;$.ajax({type:"GET",data:{"id":id,"q":q,"items":JSON.stringify(items)},dataType:"html",url:validateURL.URL()+'/products/template_modal_buy',async:false,success:function(result){var modalWrapper=$('#modal');modalWrapper.html(result);$.busyLoadFull('hide');$('#modal').modal();modalWrapper.find('[data-action="sum"],[data-action="minus"]').click(function(){modifyQuantityItemPurchase($(this))})
modalWrapper.find('.related-box').on('click','.link',function(e){e.preventDefault();var relatedItemID=$(this).data('item');var product_list=[]
modalWrapper.find('.additems_list .list .item').each(function(index,element){product_list.push($(this).data('id'));});(product_list.indexOf(relatedItemID)!==-1)?sumItemToList(relatedItemID):addItemToList(relatedItemID);});if(alternative!=undefined&&parseInt(alternative)>0){addItemToList(parseInt(alternative))}},timeout:10000});$('#modal').modal().off('hidden.bs.modal');$('#modal').modal().on('hidden.bs.modal',function(){$('#modal .modal-content').html('');$(this).modal('dispose');});}function showBuyModal(idprod,quantity,items){$.ajax({async:true,type:"POST",data:{"items":JSON.stringify(items)},dataType:"json",url:validateURL.URL()+"/shoppingcart/addtocart",async:false,success:function(data){if(data.success==true){if(window.location.pathname==validateURL.URL()+'/shoppingcart/shoppingcart'){Shoppincart.moveProductToList(idprod);}updateCart(data.totalItemsList);$(this).attr('data-item',idprod);$(this).data('qItemsAdd',quantity);$val='';$exist=$("#csi").find("[data-action='open']");if($exist.length==1)$val=$exist.find("[data-value]").data("value")
loadBuyModal($(this),$val,items);}},timeout:10000});}function addItemToList(id){$.ajax({async:true,type:"GET",data:{"id":id},dataType:"json",url:validateURL.URL()+'/products/item_list_preview',success:function(result){var target=$('#modal .modal-dialog .modal-content.modal-buy');if(!target.find('.additems_list').hasClass('compact')){target.find('.additems_list').addClass('compact')}target.find('.additems_list .list').append(result.html);$(".itemCounter:last").find('[data-action="sum"],[data-action="minus"]').click(function(){modifyQuantityItemPurchase($(this))})
if(target.find('.additems_list .list .item').length>5){target.find('.related-box').remove();}if(window.location.pathname==validateURL.URL()+'/shoppingcart/shoppingcart'){Shoppincart.moveProductToList(id);}updateCart(result.totalItemsList);ge.addToShoppingCart(result.addToCart,1);},timeout:10000});}function checkItemOnList(relatedItemID,itemID){return(itemID===relatedItemID)?true:false;}function sumItemToList(id){var target=$('#modal .modal-content .modal-body .list [data-id="'+id+'"]');target.find('[data-quantity] [data-action="sum"]').click();target.addClass('uploading');setTimeout(function(){target.removeClass('uploading');},1000);}function getNItemsCart(shoppingcart){var nItems=0;shoppingcart.forEach(function(element){nItems+=element.quantity;});return nItems;}function modifyQuantityItemPurchase($obj){var id=$obj.closest("[data-id]").data("id");var action=$obj.attr("data-action");var max=$obj.closest("[data-max]").data("max");var quantity=$obj.closest("[data-value]").data("value");var send=true;var pop=$obj.closest("#modal");if(action=="sum"&&parseInt(max)<=parseInt(quantity)){send=false;}if(action!="sum"&&parseInt(quantity)<=parseInt(1)){send=false;}if(send==true){$.ajax({async:false,type:"POST",data:{"id":id,"action":action},dataType:"json",url:validateURL.URL()+"/shoppingcart/addQuantityToCart",success:function(data){$line=$("[data-id='"+id+"']");$line.find("[data-value]").data("value",data.qItem);$line.find('[data-arg="totalLineItem"]').html(data.totalLineAmountFormat);if(window.location.pathname==validateURL.URL()+'/shoppingcart/shoppingcart'){if(data.hasPackageService){Shoppincart.has_package();}else{Shoppincart.no_package();}if(data.deliveryMethod=='delivery'){Shoppincart.calculateDeliveryHome();}if(pop.length>0){Shoppincart.moveProductToList(id);}}if(typeof Shoppincart==='object'){Shoppincart.printTotal(data);}updateCart(data.totalItemsList);if(data.quantity<0){ge.removeToShoppingCart(data.addToCart,data.quantity);}else{ge.addToShoppingCart(data.addToCart,data.quantity);}},timeout:10000});}}var ModalStock={changeCounter:function(info,operation,currentStock){Cart.numberItem=parseInt($('#modalcount_'+info).val());if(Cart.numberItem+1>=currentStock&&operation=="sum"){$('#modalplus_'+info).addClass('disabled-button');}else{$('#modalplus_'+info).removeClass('disabled-button');}if(operation=="sum"&&parseInt($('#modalcount_'+info).val())>=1){Cart.numberItem++;}else if(operation=="minus"&&parseInt($('#modalcount_'+info).val())>1){Cart.numberItem--;}$('#modalcount_'+info).val(Cart.numberItem);},markFavorites:function(info){if($('#markFavorites_'+info).hasClass('selected-to-favorites')){$('#markFavorites_'+info).removeClass('material-icons').removeClass('selected-to-favorites').addClass('icon-addfav').empty();$('#markRemoveButton_'+info).removeClass('disabled-button');$('#message_'+itemId).addClass('d-none');}else{$('#markFavorites_'+info).addClass('material-icons').addClass('selected-to-favorites').removeClass('icon-addfav').text('check_circle_outline');$('#markRemoveButton_'+info).addClass('disabled-button');$('#message_'+itemId).addClass('d-none');}},markRemove:function(info){if($('#markRemove_'+info).hasClass('selected-to-remove')){$('#markRemove_'+info).removeClass('selected-to-remove').text('delete_outline');$('#markFavoritesButton_'+info).removeClass('disabled-button');$('#message_'+itemId).addClass('d-none');}else{$('#markRemove_'+info).addClass('selected-to-remove').text('delete_forever');$('#markFavoritesButton_'+info).addClass('disabled-button');$('#message_'+itemId).addClass('d-none');}},updateFromModalStock:function(){var itemsToRemove=[];$('.selected-to-remove').each(function(index,value){itemsToRemove.push(parseInt((this.id).split("_")[1]));});var itemsToFavorites=[];$('.selected-to-favorites').each(function(index,value){itemsToFavorites.push(parseInt((this.id).split("_")[1]));});var allItemId=[];$('.modal-stock-item-list').each(function(index,value){allItemId.push(parseInt($(value).data('id')));});var itemsFavoritesRemove=itemsToRemove.concat(itemsToFavorites);var itemsToUpdate=[];Array.prototype.diff=function(a){return this.filter(function(i){return a.indexOf(i)===-1;});};itemsToUpdate=allItemId.diff(itemsFavoritesRemove);var itemsUpdateQuantity=[];for(var i=0;i<itemsToUpdate.length;i++){itemId=itemsToUpdate[i];quantity=$('#modalcount_'+itemId).val();if(typeof quantity=='undefined'){$('#message_'+itemId).removeClass('d-none');return;}item={"itemId":itemId,"qtyUpdate":quantity};itemsUpdateQuantity.push(item);};data={"itemsToRemove":itemsToRemove,"itemsToFavorites":itemsToFavorites,"itemsUpdateQuantity":itemsUpdateQuantity};$.ajax({type:"POST",data:data,dataType:"json",url:validateURL.URL()+'/shoppingcart/updateFromModalStock',}).done(function(data,textStatus,response){if(textStatus=="success"&&data=="reload"){location.reload();}else{window.location.href=validateURL.URL()+'/shoppingcart/shoppingcart';}});},showInputEmail:function(itemId){if($('#inputEmailStock_'+itemId).hasClass('d-none')){$('#inputEmailStock_'+itemId).removeClass('d-none');}else{$('#inputEmailStock_'+itemId).addClass('d-none');}},}
function updateCart(nItems){if(parseInt(nItems)>parseInt(0)){$(" #iconCart-lg .items ").show();}else{$(" #iconCart-lg .items ").hide();}$("[data-arg='totalItemsList']").html(nItems);$('#iconShoppingDesktop.shoppingCart').addClass('d-none d-lg-block');$('#iconShoppingMobile.shoppingCart').addClass('d-block d-lg-none');}function showNoStockModal(productNoStock,currentStock){var data={'productNoStock':productNoStock,'currentStock':currentStock};$('#modal').modal({keyboard:false,backdrop:'static'}).on('shown.bs.modal',function(){$.ajax({async:true,type:"POST",data:data,dataType:"html",url:validateURL.URL()+'/shoppingcart/template_modal_no_stock',success:function(result){var target=$('#modal');target.html(result);}});});}$(document).on('click','[data-action="goCart"]',function(e){$(this).parents('.modal-buy').busyLoad('show');window.location.href=validateURL.URL()+'/shoppingcart/shoppingcart';});$(document).on('click','[data-action="buy"]',function(e){let tmpItems=[];if(typeof ShoppingCartExtension!=='undefined'&&ShoppingCartExtension.items.length>0){tmpItems=ShoppingCartExtension.items;}let idprod=e.currentTarget.dataset.item;let quantity=$('.productBox .itemCounter input[type="number"]').val();quantity==null?quantity=1:quantity;tmpItems.push({id:idprod,quantity:quantity,main:true});$.busyLoadFull('show');if(window.location.pathname==validateURL.URL()+"/ItemComparator/view_comparator"){quantity=$(this).parent().parent().find('div[data-id="'+idprod+'"] input.val').val();}quantity==null?quantity=1:quantity;setTimeout(function(){showBuyModal(idprod,quantity,tmpItems);if(typeof ShoppingCartExtension!=='undefined')ShoppingCartExtension.cleanItems();},50);});$(document).on('submit','[data-action="sendEmailNotify"]',function(e){e.preventDefault();$form=$(this);email=$form.find('[name="email"]').val();id_item=$form.data("item");$.ajax({async:false,type:"POST",data:{"email":email,"id_item":id_item},dataType:"json",url:validateURL.URL()+"/products/saveItemEmailNotification",success:function(data){if(data.success==true){$form.addClass("d-none");$form.parent().find("[data-action='success']").removeClass("d-none")
$form.parents('.itemButtons').find('[data-target="#'+$form.parent().attr('id')+'"]').addClass('d-none')}else{$(".message").remove();Main.tagError('email_'+id_item,data.text)}},timeout:10000});});$(document).ready(function(){Modal.main();});